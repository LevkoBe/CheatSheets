<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Renderer</title>

    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>

    <!-- KaTeX for math rendering -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f9f9f9;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .file-input {
        margin-bottom: 20px;
        padding: 10px;
        border: 2px dashed #ccc;
        border-radius: 8px;
        text-align: center;
      }

      input[type="file"] {
        margin: 10px 0;
      }

      #content {
        margin-top: 20px;
      }

      /* Sample markdown content styling */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: #333;
        margin-top: 24px;
        margin-bottom: 16px;
      }

      pre {
        background-color: #f6f8fa;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
      }

      code {
        background-color: #f6f8fa;
        padding: 2px 4px;
        border-radius: 3px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      }

      blockquote {
        border-left: 4px solid #ddd;
        margin: 0;
        padding-left: 16px;
        color: #666;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin: 16px 0;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f6f8fa;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Markdown Renderer with Math Support</h1>

      <div class="file-input">
        <p>Choose a Markdown file to render:</p>
        <input type="file" id="fileInput" accept=".md,.markdown,.txt" />
      </div>

      <div id="content">
        <!-- Sample content will be shown here initially -->
        <h2>Sample Content</h2>
        <p>
          Upload a .md file to see it rendered here, or see the sample below:
        </p>

        <h3>Text Formatting</h3>
        <p>
          <strong>Bold text</strong>, <em>italic text</em>, and
          <code>inline code</code>
        </p>

        <h3>Math Examples</h3>
        <p>Inline math: $E = mc^2$</p>
        <p>Block math:</p>
        $$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$

        <h3>Code Block</h3>
        <pre><code class="language-javascript">function hello() {
    console.log("Hello, World!");
}</code></pre>
      </div>
    </div>

    <script>
      // Configure marked for better HTML output
      marked.setOptions({
        breaks: true,
        gfm: true,
        highlight: function (code, lang) {
          if (lang && hljs.getLanguage(lang)) {
            try {
              return hljs.highlight(code, { language: lang }).value;
            } catch (err) {}
          }
          return hljs.highlightAuto(code).value;
        },
      });

      // Function to render markdown with math
      function renderMarkdown(markdown) {
        // First, convert markdown to HTML
        const html = marked.parse(markdown);

        // Insert the HTML into the content div
        document.getElementById("content").innerHTML = html;

        // Then render math with KaTeX
        renderMathInElement(document.getElementById("content"), {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\[", right: "\\]", display: true },
            { left: "\\(", right: "\\)", display: false },
          ],
          throwOnError: false,
        });

        // Highlight code blocks
        document.querySelectorAll("pre code").forEach((block) => {
          hljs.highlightElement(block);
        });
      }

      // File input handler
      document
        .getElementById("fileInput")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const markdown = e.target.result;
              renderMarkdown(markdown);
            };
            reader.readAsText(file);
          }
        });

      // Initial render of sample content
      renderMathInElement(document.getElementById("content"), {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false },
        ],
        throwOnError: false,
      });
    </script>
  </body>
</html>
